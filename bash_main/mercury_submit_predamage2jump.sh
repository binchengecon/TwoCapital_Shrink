#! /bin/bash


# actiontime=1
# action_name="2jump_beforemayversion"
# python_name="predamage_2jump.py"


# epsilonarr=(0.005 0.005)
# fractionarr=(0.005 0.005)
# maxiterarr=(90000 90000)
# hXarr=(0.05 0.05 0.05)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)



# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# xi_a=(1000.)
# xi_p=(1000.)
# psi0arr=(0.008 0.010 0.012)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0


# actiontime=2
# action_name="2jump_cobwebversion"
# python_name="predamage_2jump_cobweb.py"


# epsilonarr=(0.005 0.005)
# fractionarr=(0.005 0.005)
# maxiterarr=(90000 90000)

# hXarr=(0.2 0.2 0.2)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)



# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# xi_a=(1000.)
# xi_p=(1000.)
# psi0arr=(0.008 0.010 0.012)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0

##############################
# prepare for interpolation
##############################

# actiontime=3
# action_name="2jump_step_0.2_0.2_0.2_LR_0.01"
# python_name="predamage_2jump_smart.py"


# epsilonarr=(0.005 0.005)
# fractionarr=(0.005 0.005)
# maxiterarr=(90000 90000)

# hXarr=(0.2 0.2 0.2)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)



# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# xi_a=(1000.)
# xi_p=(1000.)
# # psi0arr=(0.008 0.010 0.012)
# psi0arr=(0.008)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0


# actiontime=4
# action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# python_name="predamage_2jump_smart.py"


# epsilonarr=(0.005 0.008)
# fractionarr=(0.005 0.008)
# maxiterarr=(90000 90000)

# hXarr=(0.2 0.2 0.2)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)



# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# xi_a=(1000.)
# xi_p=(1000.)
# # psi0arr=(0.008 0.010 0.012)
# psi0arr=(0.008)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0










# actiontime=10
# action_name="2jump_step_0.1_0.1_0.05_LR_0.007"
# python_name="predamage_2jump.py"


# epsilonarr=(0.005 0.005)
# fractionarr=(0.005 0.005)
# maxiterarr=(90000 90000)

# hXarr=(0.1 0.1 0.05)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)



# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# xi_a=(1000.)
# xi_p=(1000.)
# # psi0arr=(0.008 0.010 0.012)
# psi0arr=(0.008)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0

# actiontime=11
# action_name="2jump_step_0.05_0.05_0.05_LR_0.005"
# python_name="predamage_2jump_smart.py"


# epsilonarr=(0.01 0.005)
# fractionarr=(0.01 0.005)
# maxiterarr=(90000 90000)

# hXarr=(0.05 0.05 0.05)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)

# hXarr_SG=(0.2 0.2 0.2)
# Xminarr_SG=(4.00 0.0 -5.5 0.0)
# Xmaxarr_SG=(9.00 4.0 0.0 3.0)
# interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# fstr_SG="NearestNDInterpolator"


# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# xi_a=(1000.)
# xi_p=(1000.)
# # psi0arr=(0.008 0.010 0.012)
# psi0arr=(0.008)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0


# actiontime=12
# action_name="2jump_step_0.05_0.05_0.05_LR_0.005_step0.2Near"
# python_name="predamage_2jump_smart.py"


# epsilonarr=(0.01 0.005)
# fractionarr=(0.01 0.005)
# maxiterarr=(90000 90000)

# hXarr=(0.05 0.05 0.05)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)

# hXarr_SG=(0.2 0.2 0.2)
# Xminarr_SG=(4.00 0.0 -5.5 0.0)
# Xmaxarr_SG=(9.00 4.0 0.0 3.0)
# interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# fstr_SG="NearestNDInterpolator"


# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# xi_a=(1000.)
# xi_p=(1000.)
# # psi0arr=(0.008 0.010 0.012)
# psi0arr=(0.008)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0


# actiontime=13
# action_name="2jump_step_0.05_0.05_0.05_LR_0.005_test"
# python_name="predamage_2jump_interp_SG.py"

# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# epsilonarr=(0.01 0.005)
# fractionarr=(0.01 0.005)
# maxiterarr=(100000 100000)

# hXarr=(0.05 0.05 0.05)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)


# hXarr_SG=(0.2 0.2 0.2)
# Xminarr_SG=(4.00 0.0 -5.5 0.0)
# Xmaxarr_SG=(9.00 4.0 0.0 3.0)
# interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# fstr_SG="NearestNDInterpolator"


# xi_a=(1000.)
# xi_p=(1000.)
# # psi0arr=(0.008 0.010 0.012)
# psi0arr=(0.008)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0

# actiontime=130
# action_name="2jump_step_0.05_0.05_0.05_LR_0.005_test2"
# python_name="predamage_2jump_interp_SG.py"

# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# epsilonarr=(0.01 0.005)
# fractionarr=(0.01 0.005)
# maxiterarr=(100000 100000)

# hXarr=(0.05 0.05 0.05)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)


# hXarr_SG=(0.2 0.2 0.2)
# Xminarr_SG=(4.00 0.0 -5.5 0.0)
# Xmaxarr_SG=(9.00 4.0 0.0 3.0)
# interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# fstr_SG="NearestNDInterpolator"


# xi_a=(1000.)
# xi_p=(1000.)
# # psi0arr=(0.008 0.010 0.012)
# psi0arr=(0.008)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0


# actiontime=14
# action_name="2jump_step_0.1_0.1_0.02_LR_0.007"
# python_name="predamage_2jump_smart.py"

# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# epsilonarr=(0.01 0.005)
# fractionarr=(0.01 0.005)
# maxiterarr=(100000 100000)

# hXarr=(0.1 0.1 0.02)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)


# hXarr_SG=(0.2 0.2 0.2)
# Xminarr_SG=(4.00 0.0 -5.5 0.0)
# Xmaxarr_SG=(9.00 4.0 0.0 3.0)
# interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# fstr_SG="NearestNDInterpolator"


# xi_a=(1000.)
# xi_p=(1000.)
# # psi0arr=(0.008 0.010 0.012)
# psi0arr=(0.008)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0


# actiontime=15
# action_name="2jump_step_0.1_0.1_0.1_LR_0.005"
# python_name="predamage_2jump_smart.py"

# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# epsilonarr=(0.01 0.005)
# fractionarr=(0.01 0.005)
# maxiterarr=(100000 100000)

# hXarr=(0.1 0.1 0.1)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)


# hXarr_SG=(0.2 0.2 0.2)
# Xminarr_SG=(4.00 0.0 -5.5 0.0)
# Xmaxarr_SG=(9.00 4.0 0.0 3.0)
# interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# fstr_SG="NearestNDInterpolator"


# xi_a=(1000.)
# xi_p=(1000.)
# # psi0arr=(0.008 0.010 0.012)
# psi0arr=(0.008)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0


# actiontime=16
# action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# python_name="predamage_2jump_smart.py"

# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# epsilonarr=(0.01 0.005)
# fractionarr=(0.01 0.005)
# maxiterarr=(100000 100000)

# hXarr=(0.2 0.2 0.2)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)


# hXarr_SG=(0.2 0.2 0.2)
# Xminarr_SG=(4.00 0.0 -5.5 0.0)
# Xmaxarr_SG=(9.00 4.0 0.0 3.0)
# interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# fstr_SG="NearestNDInterpolator"


# xi_a=(1000.)
# xi_p=(1000.)
# # psi0arr=(0.008 0.010 0.012)
# psi0arr=(0.005)
# psi1arr=(0.5)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0


# actiontime=17
# action_name="2jump_step_0.2_0.2_0.2_LR_0.1"
# python_name="predamage_2jump_smart.py"

# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# epsilonarr=(0.01 0.01)
# fractionarr=(0.01 0.01)
# maxiterarr=(100000 100000)

# hXarr=(0.2 0.2 0.2)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)


# hXarr_SG=(0.2 0.2 0.2)
# Xminarr_SG=(4.00 0.0 -5.5 0.0)
# Xmaxarr_SG=(9.00 4.0 0.0 3.0)
# interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# fstr_SG="NearestNDInterpolator"


# xi_a=(1000.)
# xi_p=(1000.)
# # psi0arr=(0.008 0.010 0.012)
# psi0arr=(0.005)
# psi1arr=(0.5)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0

# actiontime=18
# action_name="2jump_step_0.2_0.2_0.2_LR_0.01"
# python_name="predamage_2jump_smart.py"

# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# epsilonarr=(0.01 0.01)
# fractionarr=(0.01 0.01)
# maxiterarr=(100000 100000)

# hXarr=(0.2 0.2 0.2)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)


# hXarr_SG=(0.2 0.2 0.2)
# Xminarr_SG=(4.00 0.0 -5.5 0.0)
# Xmaxarr_SG=(9.00 4.0 0.0 3.0)
# interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# fstr_SG="NearestNDInterpolator"


# xi_a=(1000.)
# xi_p=(1000.)
# psi0arr=(0.008 0.010 0.012)
# # psi0arr=(0.005)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0


# actiontime=19
# action_name="2jump_step_0.1_0.1_0.1_LR_0.005_2"
# python_name="predamage_2jump_smart.py"

# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# epsilonarr=(0.01 0.01)
# fractionarr=(0.01 0.01)
# maxiterarr=(100000 100000)

# hXarr=(0.1 0.1 0.1)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)


# hXarr_SG=(0.2 0.2 0.2)
# Xminarr_SG=(4.00 0.0 -5.5 0.0)
# Xmaxarr_SG=(9.00 4.0 0.0 3.0)
# interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# fstr_SG="NearestNDInterpolator"


# xi_a=(1000.)
# xi_p=(1000.)
# psi0arr=(0.008 0.010 0.012)
# # psi0arr=(0.005)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0

# actiontime=20
# action_name="2jump_step_0.1_0.1_0.1_LR_0.008"
# python_name="predamage_2jump_smart.py"

# NUM_DAMAGE=3
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# epsilonarr=(0.01 0.008)
# fractionarr=(0.01 0.008)
# maxiterarr=(100000 100000)

# hXarr=(0.1 0.1 0.1)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)


# hXarr_SG=(0.2 0.2 0.2)
# Xminarr_SG=(4.00 0.0 -5.5 0.0)
# Xmaxarr_SG=(9.00 4.0 0.0 3.0)
# interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# fstr_SG="NearestNDInterpolator"


# xi_a=(1000.)
# xi_p=(1000.)
# psi0arr=(0.008 0.010 0.012)
# # psi0arr=(0.005)
# psi1arr=(0.8)
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0


# actiontime=21
# action_name="2jump_step_0.2_0.2_0.2_LR_0.01"
# python_name="predamage_2jump_smart.py"

# NUM_DAMAGE=20
# ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
# epsilonarr=(0.01 0.01)
# fractionarr=(0.01 0.01)
# maxiterarr=(100000 100000)

# hXarr=(0.2 0.2 0.2)
# Xminarr=(4.00 0.0 -5.5 0.0)
# Xmaxarr=(9.00 4.0 0.0 3.0)


# hXarr_SG=(0.2 0.2 0.2)
# Xminarr_SG=(4.00 0.0 -5.5 0.0)
# Xmaxarr_SG=(9.00 4.0 0.0 3.0)
# interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
# fstr_SG="NearestNDInterpolator"


# xi_a=(1000.)
# xi_p=(1000.)
# psi0arr=(0.005 0.008 0.010 0.012)
# # psi0arr=(0.005)
# psi1arr=(0.5 0.8 0.8 0.8)
# # psi1arr=(0.5)
# LENGTH_psi=$((${#psi0arr[@]}-1))
# LENGTH_xi=$((${#xi_a[@]}-1))
# count=0



actiontime=22
action_name="2jump_step_0.1_0.1_0.1_LR_0.008"
python_name="predamage_2jump_smart.py"

NUM_DAMAGE=20
ID_MAX_DAMAGE=$((NUM_DAMAGE-1))
epsilonarr=(0.01 0.008)
fractionarr=(0.01 0.008)
maxiterarr=(100000 100000)

hXarr=(0.1 0.1 0.1)
Xminarr=(4.00 0.0 -5.5 0.0)
Xmaxarr=(9.00 4.0 0.0 3.0)


hXarr_SG=(0.2 0.2 0.2)
Xminarr_SG=(4.00 0.0 -5.5 0.0)
Xmaxarr_SG=(9.00 4.0 0.0 3.0)
interp_action_name="2jump_step_0.2_0.2_0.2_LR_0.005"
fstr_SG="NearestNDInterpolator"


xi_a=(1000.)
xi_p=(1000.)
# psi0arr=(0.005 0.008 0.010 0.012)
psi0arr=(0.012)
# psi1arr=(0.5 0.8 0.8 0.8)
psi1arr=(0.8)
LENGTH_xi=$((${#xi_a[@]}-1))
LENGTH_psi=$((${#psi0arr[@]}-1))
count=0




for k in $(seq 0 $LENGTH_psi) 
do
	for j in $(seq 0 $LENGTH_xi)
	do

		mkdir -p ./job-outs/${action_name}/xia_${xi_a[$j]}_xip_${xi_p[$j]}_PSI0_${psi0arr[$k]}_PSI1_${psi1arr[$k]}/

		if [ -f ./bash/${action_name}/mercury_xia_${xi_a[$j]}_xip_${xi_p[$j]}_PSI0_${psi0arr[$k]}_PSI1_${psi1arr[$k]}.sh ]
		then
				rm ./bash/${action_name}/mercury_xia_${xi_a[$j]}_xip_${xi_p[$j]}_PSI0_${psi0arr[$k]}_PSI1_${psi1arr[$k]}.sh
		fi

        mkdir -p ./bash/${action_name}/

		touch ./bash/${action_name}/mercury_xia_${xi_a[$j]}_xip_${xi_p[$j]}_PSI0_${psi0arr[$k]}_PSI1_${psi1arr[$k]}.sh
		
		tee -a ./bash/${action_name}/mercury_xia_${xi_a[$j]}_xip_${xi_p[$j]}_PSI0_${psi0arr[$k]}_PSI1_${psi1arr[$k]}.sh << EOF
#! /bin/bash


######## login 
#SBATCH --job-name=pre${actiontime}_$count
#SBATCH --output=./job-outs/${action_name}/xia_${xi_a[$j]}_xip_${xi_p[$j]}_PSI0_${psi0arr[$k]}_PSI1_${psi1arr[$k]}/mercury_pre.out
#SBATCH --error=./job-outs/${action_name}/xia_${xi_a[$j]}_xip_${xi_p[$j]}_PSI0_${psi0arr[$k]}_PSI1_${psi1arr[$k]}/mercury_pre.err


#SBATCH --account=pi-lhansen
#SBATCH --partition=standard
#SBATCH --cpus-per-task=4
#SBATCH --mem=16G
#SBATCH --time=7-00:00:00

####### load modules
module load python/booth/3.8/3.8.5  gcc/9.2.0

echo "\$SLURM_JOB_NAME"

echo "Program starts \$(date)"

python3 /home/bcheng4/TwoCapital_Shrink/abatement/$python_name --num_gamma $NUM_DAMAGE --xi_a ${xi_a[$j]} --xi_p ${xi_p[$j]}  --epsilonarr ${epsilonarr[@]}  --fractionarr ${fractionarr[@]}   --maxiterarr ${maxiterarr[@]}  --psi_0 ${psi0arr[$k]} --psi_1 ${psi1arr[$k]} --name ${action_name} --hXarr ${hXarr[@]} --Xminarr ${Xminarr[@]} --Xmaxarr ${Xmaxarr[@]} --hXarr_SG ${hXarr_SG[@]} --Xminarr_SG ${Xminarr_SG[@]} --Xmaxarr_SG ${Xmaxarr_SG[@]} --fstr_SG ${fstr_SG} --interp_action_name ${interp_action_name}

echo "Program ends \$(date)"

EOF
count=$(($count+1))
	done
done






for k in $(seq 0 $LENGTH_psi) 
do
	for j in $(seq 0 $LENGTH_xi)
	do
		sbatch ./bash/${action_name}/mercury_xia_${xi_a[$j]}_xip_${xi_p[$j]}_PSI0_${psi0arr[$k]}_PSI1_${psi1arr[$k]}.sh 

	done
done
